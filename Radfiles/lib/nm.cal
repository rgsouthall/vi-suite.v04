{
Normal map conversion
}

A(i): select(i, A2, A3, A4);
Sx = cross(1, A, N);
Sy = cross(2, A, N);
Sz = cross(3, A, N);
mod = if(Rdot,1,-1);
ddx(dx, dy) = mod*A1*(Sx*dx+A2*dy);
ddy(dx, dy) = mod*A1*(Sy*dx+A3*dy);
ddz(dx, dy) = mod*A1*(Sz*dx+A4*dy);